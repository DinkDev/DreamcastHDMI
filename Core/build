#!/bin/bash

set -e

cd $(dirname $0)

variant=$1
shift
if [ "$variant" = "" ] ; then
    echo "usage: $0 <std|hq2x>"
    exit 1
fi

test -f firmware-utils/firmware-packer || {
    cd firmware-utils
    make
    cd ..
}

echo "set_global_assignment -name VERILOG_MACRO $variant" > local.qsf
./compile DCxPlus
./create-jic DCxPlus.cof
./create-jic DCxPlus-raw.cof
./firmware-utils/firmware-packer output_files/DCxPlus.rbf output_files/DCxPlus.dc
mkdir -p output_files/$variant
for f in jic rbf dc ; do
    mv output_files/DCxPlus.${f} output_files/DCxPlus-default.${f}
done
cp output_files/DCxPlus-default.{jic,rbf,dc} output_files/$variant
ls -alF output_files/$variant/DCxPlus-default.dc
md5sum output_files/$variant/DCxPlus-default.dc
cat output_files/DCxPlus.fit.rpt | grep '; Total logic elements               ;'
